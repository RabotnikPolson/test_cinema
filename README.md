# üé¨ TestCinema Backend ‚Äî README

–ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ –±—ç–∫–µ–Ω–¥—É –¥–∏–ø–ª–æ–º–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ¬´–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∏–ª—å–º–æ–≤ —Å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —Ä—ã–Ω–∫–∞ –∫–∏–Ω–æ–∏–Ω–¥—É—Å—Ç—Ä–∏–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞¬ª.

> –§—Ä–æ–Ω—Ç–µ–Ω–¥ –≤—ã–Ω–µ—Å–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –≠—Ç–æ—Ç README –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –±—ç–∫–µ–Ω–¥.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞](#–∫—Ä–∞—Ç–∫–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –º–æ–¥—É–ª–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–º–æ–¥—É–ª–∏)
3. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
5. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö-–∏-–º–∏–≥—Ä–∞—Ü–∏–∏)
6. [–ó–∞–ø—É—Å–∫](#–∑–∞–ø—É—Å–∫)

   * [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ Docker](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-—á–µ—Ä–µ–∑-docker)
   * [–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)](#–ª–æ–∫–∞–ª—å–Ω—ã–π-–∑–∞–ø—É—Å–∫-–±–µ–∑-docker)
7. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–æ–∫—Ä—É–∂–µ–Ω–∏—è)
8. [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è-–∏-–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
9. [REST API](#rest-api)
10. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
11. [–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#–∞–Ω–∞–ª–∏—Ç–∏–∫–∞-–∏-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)
12. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
13. [CI/CD –∏ –¥–µ–ø–ª–æ–π](#cicd-–∏-–¥–µ–ø–ª–æ–π)
14. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–∏-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
15. [–û—Ç–ª–∞–¥–∫–∞ –∏ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏](#–æ—Ç–ª–∞–¥–∫–∞-–∏-—á–∞—Å—Ç—ã–µ-–æ—à–∏–±–∫–∏)
16. [–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞](#–¥–æ—Ä–æ–∂–Ω–∞—è-–∫–∞—Ä—Ç–∞)
17. [–õ–∏—Ü–µ–Ω–∑–∏—è](#–ª–∏—Ü–µ–Ω–∑–∏—è)

---

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∏–ª—å–º–æ–≤ —Å:

* –∫–∞—Ç–∞–ª–æ–≥–æ–º —Ñ–∏–ª—å–º–æ–≤ –∏ –∂–∞–Ω—Ä–æ–≤,
* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏,
* –∏–∑–±—Ä–∞–Ω–Ω—ã–º –∏ –∏—Å—Ç–æ—Ä–∏–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤,
* —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏ –∏ –æ—Ç–∑—ã–≤–∞–º–∏,
* –º–∞–≥–∞–∑–∏–Ω–æ–º –º–µ—Ä—á–∞,
* –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –∏ –æ–ø–ª–∞—Ç–∞–º–∏,
* –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞,
* –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å OMDb –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö,
* –±–∞–∑–æ–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –ø–ª–∞–Ω–∏—Ä—É–µ–º—ã–º –º–æ–¥—É–ª–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.

–ë—ç–∫–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ API, –¥–æ–º–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –º–æ–¥—É–ª–∏

–ú–æ–Ω–æ–ª–∏—Ç –Ω–∞ Spring Boot 3 —Å –º–æ–¥—É–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å–µ—Ä–≤–∏—Å–æ–≤:

* **Auth & Users**

  * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ª–æ–≥–∏–Ω (JWT –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è).
  * –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  * –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  * –†–æ–ª–∏: `USER`, `ADMIN` (–ª–æ–∫–∞–ª—å–Ω—ã–π –∞–¥–º–∏–Ω –¥–æ—Å—Ç—É–ø–µ–Ω).

* **Catalog**

  * –§–∏–ª—å–º—ã, –∂–∞–Ω—Ä—ã, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–æ–ª—è —Ä–µ–π—Ç–∏–Ω–≥–∞.
  * –ò–º–ø–æ—Ä—Ç –∏–∑ OMDb.

* **Ratings & Reviews**

  * –û—Ü–µ–Ω–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤.
  * –û—Ç–∑—ã–≤—ã (–≤ –ø–ª–∞–Ω–∞—Ö).

* **Merch Store**

  * –¢–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã, –æ–ø–ª–∞—Ç—ã.

* **Subscriptions & Billing**

  * –ü–ª–∞–Ω –ø–æ–¥–ø–∏—Å–∫–∏, —Å—Ç–∞—Ç—É—Å, –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã.

* **Analytics**

  * –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

* **Playlists & History**

  * –ü–ª–µ–π–ª–∏—Å—Ç—ã, –∏—Å—Ç–æ—Ä–∏—è, —Å–µ—Å—Å–∏–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è.

* **News & Events**

  * –ù–æ–≤–æ—Å—Ç–∏ –∏ —Å–æ–±—ã—Ç–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.

> –í –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ ‚Äî –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã (Auth, Catalog, Recommender, Analytics, Billing) –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ API-—à–ª—é–∑–∞.

---

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **–Ø–∑—ã–∫:** Java 17
* **–§—Ä–µ–π–º–≤–æ—Ä–∫:** Spring Boot 3 (Web, Data JPA, Validation)
* **–ë–î:** PostgreSQL 16
* **–ú–∏–≥—Ä–∞—Ü–∏–∏:** Flyway
* **HTTP –∫–ª–∏–µ–Ω—Ç:** `RestTemplate`/`WebClient` –¥–ª—è OMDb
* **–°–±–æ—Ä–∫–∞:** Gradle
* **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** Docker, Docker Compose
* **–ö–µ—à/–æ—á–µ—Ä–µ–¥–∏:** –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è Redis
* **–¢–µ—Å—Ç—ã:** JUnit 5

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
  main/
    java/com/cinema/testcinema/
      config/
        AdminSeeder.java
        SecurityConfig.java
      security/
        AppUserDetailsService.java
        JwtAuthFilter.java
        JwtService.java
      controller/
        AdminAnalyticsController.java
        AuthController.java
        CommentController.java
        DebugController.java
        FavoriteController.java
        GenreController.java
        InternalCheckController.java
        MovieController.java
        ReviewController.java
        SubscriptionController.java
        UserProfileController.java
        UserSettingsController.java
      dto/
        AuthResponse.java
        CommentCreateDto.java
        CommentDto.java
        LoginRequest.java
        MovieDto.java
        ReactionToggleDto.java
        RegisterRequest.java
        ReviewCreateDto.java
        ReviewDto.java
        SubscriptionDto.java
        UserProfileDto.java
        UserSettingsDto.java
      model/
        Achievement.java
        AnalyticsDaily.java
        Comment.java
        CommentReaction.java
        Genre.java
        Movie.java
        PaymentMethod.java
        Reaction.java
        ReactionConverter.java
        Review.java
        Role.java
        Subscription.java
        User.java
        UserAchievement.java
        UserProfile.java
        UserSettings.java
      repository/
        AnalyticsDailyRepository.java
        CommentReactionRepository.java
        CommentRepository.java
        FavoriteRepository.java
        GenreRepository.java
        MovieRepository.java
        ReviewRepository.java
        SubscriptionRepository.java
        UserProfileRepository.java
        UserRepository.java
        UserSettingsRepository.java
      service/
        AuthService.java
        CommentService.java
        FavoriteService.java
        MovieService.java
        OmdbService.java
        ReviewService.java
        SubscriptionService.java
        UserProfileService.java
        UserService.java
        UserSettingsService.java
      TestCinemaApplication.java
    resources/
      application.properties
      db/migration/
        V1_1__core_settings_profile.sql
        V1_2__achievements.sql
        V1_3__subscription_billing.sql
        V1_4__analytics_merch.sql
        V1_5__favorites.sql
        V1_6__history.sql
        V1_7__user_ratings.sql
        V1_8__playlists.sql
        V1_9__news.sql
        V1_10__user_events.sql
        V1_11__watch_sessions.sql
        V2_1__comments_and_reviews.sql
  test/
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

* –û—Å–Ω–æ–≤–Ω–∞—è –ë–î: PostgreSQL 16.
* –°—Ö–µ–º–∞: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è `public` (–∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ —Å–≤–æ—é –≤ `spring.jpa.properties.hibernate.default_schema`).
* –ú–∏–≥—Ä–∞—Ü–∏–∏: Flyway ‚Äî –≤—Å–µ DDL/seed –≤ `src/main/resources/db/migration`.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

* `users`, `user_profiles`, `user_settings`
* `movies`, `genres`, `movie_genres` (m:n)
* `ratings` (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ—Ü–µ–Ω–∫–∏)
* `playlists`, `playlist_items`
* `watch_history`, `watch_sessions`, `watch_heartbeats`
* `merch_products`, `merch_orders`
* `subscriptions`, `payment_methods`
* `analytics_daily`
* `achievements`, `user_achievements`
* `news`, `user_events`
* `products`, `orders`, `order_items` (–¥–ª—è –≤–∏—Ç—Ä–∏–Ω—ã)

> –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Flyway. –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –Ω–æ–≤—É—é `Vxxx__*.sql`.

---

## –ó–∞–ø—É—Å–∫

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç —á–µ—Ä–µ–∑ Docker

1. –°–æ–∑–¥–∞–π—Ç–µ `.env` (—Å–º. –Ω–∏–∂–µ).
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker Desktop.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ:

   ```bash
   docker compose up -d --build
   ```
4. –ë—ç–∫–µ–Ω–¥ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8080`.

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π PostgreSQL 16 –∏ JDK 17.

1. –°–æ–∑–¥–∞–π—Ç–µ –ë–î –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

   ```sql
   CREATE USER test_user WITH PASSWORD 'test_password';
   CREATE DATABASE testdb OWNER test_user;
   ```
2. –û–±–Ω–æ–≤–∏—Ç–µ `application.properties` –∏–ª–∏ `.env`.
3. –ó–∞–ø—É—Å–∫:

   ```bash
   ./gradlew bootRun
   ```
4. –°–±–æ—Ä–∫–∞ jar:

   ```bash
   ./gradlew clean build
   java -jar build/libs/testcinema-*.jar
   ```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ:

```dotenv
# Application
APP_PORT=8080
APP_ENV=local

# Postgres
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=testdb
POSTGRES_USER=test_user
POSTGRES_PASSWORD=test_password
POSTGRES_SCHEMA=public

# JPA
SPRING_JPA_HBM2DDL=none           # —Ç–æ–ª—å–∫–æ Flyway
SPRING_JPA_SHOW_SQL=false

# OMDb
OMDB_API_KEY=put-your-key-here

# Security
JWT_SECRET=local-dev-secret
JWT_TTL_MIN=120

# Admin seed (–ª–æ–∫–∞–ª—å–Ω–æ)
ADMIN_USERNAME=admin
ADMIN_PASSWORD=ADMIN
```

`application.properties` –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```properties
server.port=${APP_PORT:8080}

spring.datasource.url=jdbc:postgresql://${POSTGRES_HOST:localhost}:${POSTGRES_PORT:5432}/${POSTGRES_DB:testdb}
spring.datasource.username=${POSTGRES_USER:test_user}
spring.datasource.password=${POSTGRES_PASSWORD:test_password}

spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HBM2DDL:none}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.default_schema=${POSTGRES_SCHEMA:public}

spring.flyway.enabled=true
spring.flyway.schemas=${POSTGRES_SCHEMA:public}

omdb.api.key=${OMDB_API_KEY}
```

---

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

* **–°—Ç–∞—Ç—É—Å:** –±–∞–∑–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/–ª–æ–≥–∏–Ω —É–∂–µ –µ—Å—Ç—å (`/api/auth/register`, `/api/auth/login`). –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ **JWT** –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω.
* **–õ–æ–∫–∞–ª—å–Ω—ã–π –∞–¥–º–∏–Ω:** –ø–∞—Ä–æ–ª—å `ADMIN` –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è).
* **–†–æ–ª–∏:** –º–∏–Ω–∏–º—É–º `USER`, `ADMIN`.
* **–ü–ª–∞–Ω:** —Ñ–∏–ª—å—Ç—Ä JWT, refresh-—Ç–æ–∫–µ–Ω—ã, `@PreAuthorize` –Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, CORS.

---

## REST API

–ù–∏–∂–µ ‚Äî –∫–ª—é—á–µ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –Ω–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### Auth

* `POST /api/auth/register`

  ```json
  { "username": "user1", "password": "pass", "email": "u@ex.com" }
  ```
* `POST /api/auth/login`

  ```json
  { "username": "user1", "password": "pass" }
  ```

  –û—Ç–≤–µ—Ç: `AuthResponse` —Å —Ç–æ–∫–µ–Ω–æ–º –∏–ª–∏ —Å–µ—Å—Å–∏–µ–π; JWT –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è.

### Users & Settings

* `GET /api/users/{id}` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å
* `PUT /api/users/{id}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
* `GET /api/user-settings/me` ‚Äî –º–æ–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
* `PUT /api/user-settings/me` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### Genres

* `GET /api/genres` ‚Äî —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤
* `POST /api/genres` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∂–∞–Ω—Ä (admin)

### Movies

* `GET /api/movies` ‚Äî —Å–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
* `GET /api/movies/{id}` ‚Äî –¥–µ—Ç–∞–ª–∏
* `POST /api/movies` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º (admin)
* `POST /api/movies/import/omdb?imdbId=tt....` ‚Äî –∏–º–ø–æ—Ä—Ç –∏–∑ OMDb (admin)

### Ratings

* `POST /api/ratings` ‚Äî –ø–æ—Å—Ç–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É

  ```json
  { "movieId": 123, "score": 8 }
  ```
* `GET /api/ratings/summary/{movieId}` ‚Äî –∞–≥—Ä–µ–≥–∞—Ç—ã —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–µ–π—á–∞—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–ª—É—à–∫—É –¥–ª—è `currentUser()` –¥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è JWT.

### Merch

* `GET /api/merch/products`
* `POST /api/merch/orders` ‚Äî –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑

### Subscriptions

* `GET /api/subscriptions/me`
* `PUT /api/subscriptions/me` ‚Äî —Å–º–µ–Ω–∞ –ø–ª–∞–Ω–∞

### –ò—Å—Ç–æ—Ä–∏—è, –ø–ª–µ–π–ª–∏—Å—Ç—ã, –Ω–æ–≤–æ—Å—Ç–∏ –∏ –¥—Ä.

* –ú–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã –º–æ–¥–µ–ª—è–º–∏ –∏ DTO. –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö –º–∏–≥—Ä–∞—Ü–∏–π –∏ —Ä–µ–ª–∏–∑–æ–≤.

#### –ü—Ä–∏–º–µ—Ä—ã cURL

```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"username":"demo","password":"demo","email":"demo@ex.com"}'

# –õ–æ–≥–∏–Ω
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"demo","password":"demo"}'

# –°–ø–∏—Å–æ–∫ —Ñ–∏–ª—å–º–æ–≤
curl http://localhost:8080/api/movies

# –û—Ü–µ–Ω–∫–∞ —Ñ–∏–ª—å–º–∞ (–ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è JWT: -H "Authorization: Bearer <token>")
curl -X POST http://localhost:8080/api/ratings \
  -H "Content-Type: application/json" \
  -d '{"movieId":1,"score":9}'
```

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### OMDb

* –°–µ—Ä–≤–∏—Å: `OmdbService`
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

  * –ü–æ `imdbId` –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –≥–æ–¥, –ø–æ—Å—Ç–µ—Ä, –æ–ø–∏—Å–∞–Ω–∏–µ).
  * –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î —á–µ—Ä–µ–∑ `MovieService`.
* –¢—Ä–µ–±—É–µ—Ç—Å—è `OMDB_API_KEY`.

---

## –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### Analytics

* –°—É—â–Ω–æ—Å—Ç—å `AnalyticsDaily` –∫–æ–ø–∏—Ç –∞–≥—Ä–µ–≥–∞—Ç—ã:

  * –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞, CTR –∏ –¥—Ä.
* –ü–ª–∞–Ω: —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–π, –≤—ã–≥—Ä—É–∑–∫–∞ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

### Recommender (–ø–ª–∞–Ω)

* –ö–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –±–∞–∑–µ `ratings`, `watch_history`, –∂–∞–Ω—Ä–æ–≤.
* –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ñ–ª–∞–π–Ω-–æ—Ü–µ–Ω–∫–∏ (Precision@K), –∫–æ–Ω—Ñ–∏–≥ `topK`, `shrink`.
* –û—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –∏–ª–∏ —Å–µ—Ä–≤–∏—Å —Å REST API: `/api/recs/me`.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

* –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤: JUnit 5.
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã REST —Å `@SpringBootTest` –∏ Testcontainers PostgreSQL.
* Smoke-–Ω–∞–±–æ—Ä –¥–ª—è CI.

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
./gradlew test
```

---

## CI/CD –∏ –¥–µ–ø–ª–æ–π

* **CI:** GitHub Actions (—Å–±–æ—Ä–∫–∞, —Ç–µ—Å—Ç—ã, –ø—É–±–ª–∏–∫–∞—Ü–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞).
* **CD:** Render/Railway –¥–ª—è –±—ç–∫–µ–Ω–¥–∞, Vercel/Netlify –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞.
* **–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:** jar, –¥–æ–∫–µ—Ä-–æ–±—Ä–∞–∑—ã, –º–∏–≥—Ä–∞—Ü–∏–∏ Flyway –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ.
* **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** —á–µ—Ä–µ–∑ Secrets.

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

* –ò–Ω–¥–µ–∫—Å—ã –ø–æ –∫–ª—é—á–µ–≤—ã–º –ø–æ–ª—è–º (`movie_id`, `user_id`, `created_at`).
* –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ –ø—Ä–æ–µ–∫—Ü–∏–∏ DTO.
* –ü–ª–∞–Ω: –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—è—á–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, Redis.

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

* –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ JWT, –ø–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—å —Å BCrypt.
* CORS –ø–æ —Å–ø–∏—Å–∫—É –¥–æ–º–µ–Ω–æ–≤.
* –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö DTO, –ª–∏–º–∏—Ç—ã –Ω–∞ —Ä–∞–∑–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤.
* –°–µ–∫—Ä–µ—Ç—ã —Ç–æ–ª—å–∫–æ –∏–∑ –æ–∫—Ä—É–∂–µ–Ω–∏—è/Secrets.

---

## –û—Ç–ª–∞–¥–∫–∞ –∏ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

1. **`–û–®–ò–ë–ö–ê: —Å—Ö–µ–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ –≤—ã–±—Ä–∞–Ω–∞`**
   –†–µ—à–µ–Ω–∏–µ: —É–∫–∞–∂–∏—Ç–µ —Å—Ö–µ–º—É:

   * –í –ë–î:

     ```sql
     ALTER ROLE test_user SET search_path TO public;
     ```
   * –ò–ª–∏ –≤ `application.properties`:

     ```properties
     spring.jpa.properties.hibernate.default_schema=public
     spring.flyway.schemas=public
     ```

2. **`role "cinema" does not exist` / –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞**
   –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–ë–î –∏ –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.

3. **HTTP 401 –ø—Ä–∏ `/api/auth/login`**
   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `AuthController` –∏ `AuthService` –ø–æ–¥–∫–ª—é—á–µ–Ω—ã, –∏ —Ñ—Ä–æ–Ω—Ç —à–ª—ë—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON. –î–ª—è –ª–æ–∫–∞–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –∞–¥–º–∏–Ω-–ª–æ–≥–∏–Ω —Å –ø–∞—Ä–æ–ª–µ–º `ADMIN` (–¥–æ –≤–∫–ª—é—á–µ–Ω–∏—è JWT).

4. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è**
   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `spring.flyway.enabled=true`, –º–∏–≥—Ä–∞—Ü–∏–∏ –ª–µ–∂–∞—Ç –≤ `db/migration`, –∏ –≤–µ—Ä—Å–∏—è —Å–ª–µ–¥—É—é—â–∞—è –ø–æ –ø–æ—Ä—è–¥–∫—É.

5. **–î–æ–ª–≥–∏–µ –æ—Ç–≤–µ—Ç—ã IDE/—Å–∫—Ä–∏–ø—Ç–æ–≤**
   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

   * –≤–∫–ª—é—á–µ–Ω–æ –ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ SQL,
   * –Ω–µ—Ç –ª–∏ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤,
   * –≤—ã—Å—Ç–∞–≤–ª–µ–Ω—ã –ª–∏ –∏–Ω–¥–µ–∫—Å—ã,
   * –ø–∞—Ä–∞–º–µ—Ç—Ä—ã JVM: `-Xms512m -Xmx1g` –¥–ª—è –ª–æ–∫–∞–ª–∏.

---

## –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞

* [ ] JWT: access/refresh, —Ä–æ–ª–∏, guard –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
* [ ] –†–µ–π—Ç–∏–Ω–≥–∏: –∑–∞–≤–µ—Ä—à–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤—ã
* [ ] –ò—Å—Ç–æ—Ä–∏—è/–ø–ª–µ–π–ª–∏—Å—Ç—ã: REST –∏ —Å–µ—Ä–≤–∏—Å—ã
* [ ] Analytics: —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, —ç–∫—Å–ø–æ—Ä—Ç –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞
* [ ] –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å: API, –æ—Ñ–ª–∞–π–Ω-–º–µ—Ç—Ä–∏–∫–∏, A/B
* [ ] –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Redis
* [ ] Webhook –ø–ª–∞—Ç–µ–∂–µ–π –∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –±–∏–ª–ª–∏–Ω–≥
* [ ] –ú–µ–¥–∏–∞—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–æ—Å—Ç–µ—Ä–æ–≤/—Ç—Ä–µ–π–ª–µ—Ä–æ–≤ (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ)
* [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è OpenAPI/Swagger
* [ ] –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç—É—Ä –∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT –∏–ª–∏ –¥—Ä—É–≥–∞—è –ø–æ –≤—ã–±–æ—Ä—É. –î–æ–±–∞–≤—å—Ç–µ —Ñ–∞–π–ª `LICENSE`.

---

### –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏

* **–ó–∞–ø—É—Å–∫:** Docker ‚Äî `docker compose up -d --build`
* **Env:** —Å–º. –ø—Ä–∏–º–µ—Ä `.env`
* **–ê–¥–º–∏–Ω –ª–æ–∫–∞–ª—å–Ω–æ:** –ø–∞—Ä–æ–ª—å `ADMIN`
* **OMDb:** –∑–∞–¥–∞–π—Ç–µ `OMDB_API_KEY`

